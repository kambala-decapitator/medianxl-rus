# Утилиты для [торрент раздачи](https://rutracker.org/forum/viewtopic.php?t=5686364) Median XL Σ

## Установщик

Используется [Inno Setup](https://jrsoftware.org/isinfo.php), файл `setup.iss`.

По умолчанию выбирается папка игры внутри раздачи, что позволяет установить мод прямо внутрь раздачи (хэш файлов не портится) и запускать игру оттуда, устраняя необходимость копировать папку с игрой в другое место.

### Назначение

Установщик выполняет следующие действия:

- устанавливает файлы мода и русификатора
- устанавливает [Sven's Glide Wrapper](https://www.svenswrapper.de/english/index.html) (глайд) (по желанию пользователя)
- устанавливает официальный лаунчер (по желанию пользователя)
- создаёт необходимые папки: `%APPDATA%\MedianXL\save` и `Logs`, `Screenshots`, `Themes` в папке игры
- создаёт файл `cmd_args.txt` в папке игры при его отсутствии: он необходим для корректного запуска через батники
- создаёт запись в реестре с путём к папке игры при её отсутствии: это необходимо для корректного функционирования игры, ключ `HKEY_CURRENT_USER\Software\Blizzard Entertainment\Diablo II\InstallPath`
- задаёт совместимость с Windows XP SP3 файлам игры `D2VidTst.exe` и `Game.exe`
- создаёт ярлыки запуска русской и английской версий мода на рабочем столе и в меню Пуск (по желанию пользователя)
- запускает видео тест после установки (по желанию пользователя): это необходимо лишь в случае, если до этого он никогда не запускался, либо если игра была полностью удалена с помощью «деустановщика» (с удалением записей реестра)

### Компиляция

    iscc /O. /F"MXL_Sigma_setup" <путь к репозиторию>\torrent-setup\setup.iss

## Настройка параметров запуска Diablo II

PowerShell скрипт-программа, позволяющая выбрать нужные ключи запуска Diablo II. Ключи сохраняются в файл `cmd_args.txt` в папке запуска скрипта. Этот файл читается батниками запуска игры, включёнными в раздачу.

Bat файл создан чисто ради запуска скрипта двойным кликом, т.к. по умолчанию PowerShell скрипты можно запускать лишь вручную из терминала.

Тестировалось на Windows 8.1 с PowerShell версии 5.1.
